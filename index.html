<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharma-Ultimate: ××¢×¨×›×ª ×œ××™×“×”</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --error: #c0392b;
            --bg: #f4f7f6;
            --card: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: #333;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--card);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }

        /* --- Header --- */
        header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header-title { margin: 0; font-size: 1.8rem; }
        .header-subtitle { opacity: 0.8; font-size: 0.9rem; margin-top: 5px; }
        
        /* Stats Bar (Timer/Score) */
        .status-bar {
            background: #ecf0f1;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
            color: var(--primary);
        }

        /* --- Screens --- */
        .screen {
            padding: 30px;
            flex: 1;
            display: none; /* Hidden by default */
            flex-direction: column;
        }
        
        .screen.active { display: flex; }

        /* Menu Buttons */
        .menu-btn {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 20px;
            margin: 10px 0;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: bold;
        }

        .menu-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .menu-btn.exam { border-color: var(--error); color: var(--error); }
        .menu-btn.exam:hover { background: var(--error); color: white; }

        /* Question Styles */
        .q-card { margin-bottom: 20px; }
        .q-text { font-size: 1.3rem; font-weight: 600; margin-bottom: 20px; line-height: 1.4; }
        
        .options-grid { display: grid; gap: 10px; }
        
        .opt-btn {
            background: white;
            border: 2px solid #bdc3c7;
            padding: 15px;
            border-radius: 8px;
            text-align: right;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }

        .opt-btn:hover { background: #f0f3f4; border-color: var(--accent); }

        /* Practice Mode Specifics */
        .practice-feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #fff3cd;
            border-right: 5px solid #ffc107;
            display: none;
            animation: fadeIn 0.3s;
        }

        .opt-btn.correct { background: #d4efdf; border-color: var(--success); color: var(--success); font-weight: bold; }
        .opt-btn.wrong { background: #fadbd8; border-color: var(--error); color: var(--error); opacity: 0.7; }
        
        /* Exam Mode Selection */
        .opt-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }

        /* Navigation */
        .nav-area {
            margin-top: auto;
            display: flex;
            justify-content: space-between;
            padding-top: 20px;
        }

        .nav-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            background: var(--primary);
            color: white;
        }
        
        .nav-btn.secondary { background: #95a5a6; }
        .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Results */
        .results-box { text-align: center; }
        .score-display { font-size: 4rem; font-weight: bold; color: var(--primary); margin: 20px 0; }
        .review-list { text-align: right; margin-top: 20px; max-height: 400px; overflow-y: auto; }
        .review-item { border-bottom: 1px solid #eee; padding: 10px; }
        .review-item.bad { background: #fff5f5; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 class="header-title">Pharma-Ultimate</h1>
        <div class="header-subtitle">××¢×¨×›×ª ×ª×¨×’×•×œ ×•×¡×™××•×œ×¦×™×” ×‘×¤×¨××§×•×œ×•×’×™×”</div>
    </header>

    <div id="screen-menu" class="screen active">
        <h2 style="text-align:center; color:var(--primary)">×‘×—×¨ ××¦×‘ ×œ××™×“×”:</h2>
        
        <button class="menu-btn" onclick="startPractice()">
            <span>â™¾ï¸</span>
            <div>
                <div>××¦×‘ ×ª×¨×’×•×œ ×¨×¦×™×£ (Practice)</div>
                <small style="font-weight:normal; opacity:0.8">××©×•×‘ ××™×™×“×™, ×©××œ×•×ª ×œ× × ×’××¨×•×ª</small>
            </div>
        </button>

        <button class="menu-btn exam" onclick="startExam()">
            <span>â±ï¸</span>
            <div>
                <div>×¡×™××•×œ×¦×™×™×ª ××‘×—×Ÿ (Exam)</div>
                <small style="font-weight:normal; opacity:0.8">45 ×©××œ×•×ª, ×˜×™×™××¨ ×¨×¥, ×¦×™×•×Ÿ ×‘×¡×•×£</small>
            </div>
        </button>
    </div>

    <div id="screen-practice" class="screen">
        <div class="status-bar">
            <span>××¦×‘ ×ª×¨×’×•×œ</span>
            <span>×©××œ×” <span id="prac-count">1</span></span>
        </div>
        <div id="prac-area">
            </div>
        <div class="nav-area">
            <button class="nav-btn secondary" onclick="goHome()">×ª×¤×¨×™×˜ ×¨××©×™</button>
            <button class="nav-btn" id="prac-next-btn" onclick="nextPracticeQ()" style="display:none">×”×©××œ×” ×”×‘××” âœ</button>
        </div>
    </div>

    <div id="screen-exam" class="screen">
        <div class="status-bar">
            <span id="exam-timer">00:00</span>
            <span>×©××œ×” <span id="exam-q-num">1</span> / 45</span>
        </div>
        <div id="exam-area">
            </div>
        <div class="nav-area">
            <button class="nav-btn secondary" id="exam-prev" onclick="prevExamQ()">×”×§×•×“×</button>
            <button class="nav-btn" id="exam-next" onclick="nextExamQ()">×”×‘×</button>
            <button class="nav-btn" id="exam-finish" onclick="finishExam()" style="background:var(--success); display:none">×”×’×© ××‘×—×Ÿ ğŸ</button>
        </div>
    </div>

    <div id="screen-results" class="screen">
        <div class="results-box">
            <h2>×ª×•×¦××•×ª ×”××‘×—×Ÿ</h2>
            <div class="score-display" id="final-score">0</div>
            <p id="score-msg"></p>
            <button class="nav-btn" onclick="goHome()">×—×–×•×¨ ×œ×ª×¤×¨×™×˜</button>
        </div>
        <hr>
        <h3>×¤×™×¨×•×˜ ×˜×¢×•×™×•×ª ×•×ª×©×•×‘×•×ª:</h3>
        <div class="review-list" id="review-container"></div>
    </div>
</div>

<script>
    /* --- DATABASE --- */
    const questionBank = [
        // HTN & Cardiac
        { q: "××˜×•×¤×œ ××¡××˜×™ ×××•×‘×—×Ÿ ×¢× ×™×ª×¨ ×œ×—×¥ ×“×. ××™×–×• ×ª×¨×•×¤×” ××¡×•×¨×” ×œ×©×™××•×© (Contraindication)?", a: "Propranolol", opts: ["Amlodipine", "Hydrochlorothiazide", "Losartan"], expl: "Propranolol ×—×•×¡× ×¨×¦×¤×˜×•×¨×™ B2 ×‘×¨×™××•×ª ×•×’×•×¨× ×œ×›×™×•×•×¥ ×¡××¤×•× ×•×ª." },
        { q: "××”×™ ×ª×•×¤×¢×ª ×”×œ×•×•××™ ×”×©×›×™×—×” ×‘×™×•×ª×¨ ×©×œ ACE Inhibitors (×›×’×•×Ÿ Captopril)?", a: "×©×™×¢×•×œ ×™×‘×©", opts: ["×‘×¦×§×ª ×‘×§×¨×¡×•×œ×™×™×", "×“×•×¤×§ ××”×™×¨", "×¢×¦×™×¨×•×ª"], expl: "× ×’×¨× ×¢×§×‘ ×”×¦×˜×‘×¨×•×ª ×‘×¨×“×™×§×™× ×™×Ÿ ×‘×¨×™××•×ª." },
        { q: "××˜×•×¤×œ × ×•×˜×œ Prazosin. ××ª×™ ××•××œ×¥ ×œ×™×˜×•×œ ××ª ×”×× ×” ×”×¨××©×•× ×”?", a: "×œ×¤× ×™ ×”×©×™× ×”", opts: ["×‘×‘×•×§×¨ ×¢× ×”××•×›×œ", "×©×¢×” ×œ×¤× ×™ ×¤×¢×™×œ×•×ª", "××™×“ ×‘×§×™××”"], expl: "×œ×× ×™×¢×ª ×¢×™×œ×¤×•×Ÿ (First Dose Effect) ×›×ª×•×¦××” ×× ×¤×™×œ×ª ×œ×—×¥ ×“× ×‘×¢××™×“×”." },
        { q: "××™×–×• ×ª×¨×•×¤×” ×’×•×¨××ª ×œ× ×¤×™×—×•×ª ×‘×—× ×™×›×™×™× (Gingival Hyperplasia)?", a: "Nifedipine", opts: ["Furosemide", "Metoprolol", "Captopril"], expl: "××•×¤×™×™× ×™ ×œ×—×•×¡××™ ×ª×¢×œ×•×ª ×¡×™×“×Ÿ (×•×›×Ÿ ×œ×¤× ×™×˜×•××™×Ÿ)." },
        { q: "××”×• ×”×¡×™××Ÿ ×”××•×§×“× ×œ×”×¨×¢×œ×ª Digoxin?", a: "×”×¤×¨×¢×•×ª ×‘×¨××™×™×” (×”×™×œ×•×ª) ×•×‘×—×™×œ×•×ª", opts: ["×©×™×¢×•×œ ×“××™", "×¢×¦×™×¨×•×ª", "×›××‘×™ ×©×¨×™×¨×™×"], expl: "×¨××™×™×ª ×”×™×œ×•×ª ×¦×”×•×‘×•×ª/×™×¨×•×§×•×ª ×”×™× ×¡×™××Ÿ ×“×’×œ ×œ×”×¨×¢×œ×”." },
        { q: "××™×–×” ××œ×§×˜×¨×•×œ×™×˜ ×™×© ×œ× ×˜×¨ ×‘×˜×™×¤×•×œ ×‘-Furosemide (Lasix)?", a: "××©×œ×’×Ÿ (×¡×›× ×ª ×”×™×¤×•×§×œ××™×”)", opts: ["× ×ª×¨×Ÿ ×‘×œ×‘×“", "×¡×™×“×Ÿ (×¡×›× ×ª ×”×™×¤×¨×§×œ×¦××™×”)", "×‘×¨×–×œ"], expl: "××©×ª× ×™ ×œ×•×œ××” ×’×•×¨××™× ×œ××™×‘×•×“ ××©××¢×•×ª×™ ×©×œ ××©×œ×’×Ÿ ×‘×©×ª×Ÿ." },
        { q: "×›×™×¦×“ ×¤×•×¢×œ Spironolactone?", a: "×—×•×¡× ×¨×¦×¤×˜×•×¨ ×œ××œ×“×•×¡×˜×¨×•×Ÿ", opts: ["×—×•×¡× ×ª×¢×œ×•×ª × ×ª×¨×Ÿ", "××¢×›×‘ ACE", "××¨×—×™×‘ ×›×œ×™ ×“× ×™×©×™×¨"], expl: "××©×ª×Ÿ ××©××¨ ××©×œ×’×Ÿ, ×× ×˜×’×•× ×™×¡×˜ ×œ××œ×“×•×¡×˜×¨×•×Ÿ." },
        { q: "××”×™ ×”×¡×›× ×” ×‘×©×™××•×© ×‘-Amiodarone?", a: "×¤×™×‘×¨×•×–×™×¡ ×¨×™××ª×™ (Pulmonary Fibrosis)", opts: ["×ª×¡×—×™×£ ×¨×™××ª×™", "××¡×ª××”", "×“×œ×§×ª ×¨×™××•×ª"], expl: "×ª×•×¤×¢×ª ×œ×•×•××™ ×§×©×” ×•××¡×›× ×ª ×—×™×™× ×‘×¨×™××•×ª." },
        
        // Antibiotics
        { q: "××”×™ ×ª×•×¤×¢×ª Red Man Syndrome?", a: "×©×—×¨×•×¨ ×”×™×¡×˜××™×Ÿ ×‘×’×œ×œ ××ª×Ÿ ××”×™×¨ ×©×œ Vancomycin", opts: ["××œ×¨×’×™×” ×œ×¤× ×™×¦×™×œ×™×Ÿ", "×ª×’×•×‘×” ×œ×˜×˜×¨×¦×™×§×œ×™×Ÿ", "×–×™×”×•× ××©× ×™"], expl: "× ×’×¨××ª ××”×–×¨×§×” ××”×™×¨×” ××“×™ ×©×œ ×•× ×§×•××™×¦×™×Ÿ." },
        { q: "×œ××™ ××¡×•×¨ ×œ×ª×ª Tetracycline?", a: "×™×œ×“×™× ××ª×—×ª ×œ×’×™×œ 8 ×•× ×©×™× ×‘×”×¨×™×•×Ÿ", opts: ["×—×•×œ×™ ×¡×•×›×¨×ª", "×§×©×™×©×™×", "×¨×’×™×©×™× ×œ×¤× ×™×¦×™×œ×™×Ÿ"], expl: "×©×•×§×¢ ×‘×¢×¦××•×ª ×•×¦×•×‘×¢ ×©×™× ×™×™× ×‘××•×¤×Ÿ ×‘×œ×ª×™ ×”×¤×™×š." },
        { q: "××”×™ ×”×¨×¢×™×œ×•×ª ×”×¢×™×§×¨×™×ª ×©×œ Gentamicin?", a: "×›×œ×™×•×ª (Nephro) ×•××•×–× ×™×™× (Oto)", opts: ["×›×‘×“ ×•×œ×‘", "×§×™×‘×” ×•×•×•×©×˜", "×¢×•×¨ ×•×¢×™× ×™×™×"], expl: "×××™× ×•×’×œ×™×§×•×–×™×“×™× ×¤×•×’×¢×™× ×‘×›×œ×™×” ×•×‘×©××™×¢×”." },
        { q: "××˜×•×¤×œ ×”××§×‘×œ Metronidazole ×©×•×ª×” ××œ×›×•×”×•×œ. ××” ×™×§×¨×”?", a: "×‘×—×™×œ×•×ª ×•×”×§××•×ª ×§×©×•×ª (Disulfiram Effect)", opts: ["×œ× ×™×§×¨×” ×›×œ×•×", "×‘×™×˜×•×œ ×”×× ×˜×™×‘×™×•×˜×™×§×”", "×™×©× ×•× ×™×•×ª"], expl: "×”×ª×¨×•×¤×” ××¢×›×‘×ª ×¤×™×¨×•×§ ××œ×›×•×”×•×œ ×•×’×•×¨××ª ×œ×”×¦×˜×‘×¨×•×ª ×¨×¢×œ×Ÿ." },
        { q: "×¡×›× ×” ×‘×©×™××•×© ×‘-Chloramphenicol ×‘×ª×™× ×•×§×•×ª?", a: "Gray Baby Syndrome", opts: ["Red Man Syndrome", "××•×•×ª ×‘×¢×¨×™×¡×”", "××™ ×¡×¤×™×§×ª ×›×‘×“"], expl: "×§×•×¨×¡ ××¢×¨×›×•×ª ×‘×’×œ×œ ×—×•×¡×¨ ×™×›×•×œ×ª ×œ×¤×¨×§ ××ª ×”×ª×¨×•×¤×”." },
        { q: "××™×–×• ×ª×¨×•×¤×” ×¦×•×‘×¢×ª ×©×ª×Ÿ ×‘×›×ª×•×/××“×•×?", a: "Rifampin", opts: ["Penicillin", "Gentamicin", "Vancomycin"], expl: "×œ× ××¡×•×›×Ÿ, ××š ××‘×”×™×œ ××ª ×”××˜×•×¤×œ." },
        { q: "×¡×›× ×” ×‘×©×™××•×© ×‘-Ciprofloxacin?", a: "×§×¨×¢ ×‘×’×™×“ ××›×™×œ×¡", opts: ["×©×™×¢×•×œ", "×¢×¦×™×¨×•×ª", "× ×©×™×¨×ª ×©×™×¢×¨"], expl: "×§×•×•×™× ×•×œ×•× ×™× ××—×œ×™×©×™× ×’×™×“×™×." },
        { q: "×”×× ××•×ª×¨ ×œ×ª×ª Cephalosporins ×œ×¨×’×™×©×™× ×œ×¤× ×™×¦×™×œ×™×Ÿ?", a: "××¡×•×¨, ×™×© ×¨×’×™×©×•×ª ×¦×•×œ×‘×ª (Cross Sensitivity)", opts: ["××•×ª×¨ ×—×•×¤×©×™", "×¨×§ ×“×•×¨ 3", "×¨×§ ×‘×›×“×•×¨×™×"], expl: "×™×© ×“××™×•×Ÿ ×‘××‘× ×” ×”×›×™××™ (×˜×‘×¢×ª ×‘×˜×-×œ×§×˜×)." },

        // Diabetes & Epilepsy
        { q: "××ª×™ ××–×¨×™×§×™× Insulin Lispro?", a: "×××© ×¢× ×”××•×›×œ (0-15 ×“×§')", opts: ["×©×¢×” ×œ×¤× ×™", "×œ×¤× ×™ ×”×©×™× ×”", "×‘×¦×•×"], expl: "×–×”×• ××™× ×¡×•×œ×™×Ÿ ××”×™×¨ ×××•×“." },
        { q: "×¡×›× ×” ×‘-Metformin ×•××™ ×¡×¤×™×§×ª ×›×œ×™×•×ª?", a: "Lactic Acidosis", opts: ["×”×™×¤×•×’×œ×™×§××™×”", "×¢×œ×™×™×” ×‘××©×§×œ", "×™×ª×¨ ×œ×—×¥ ×“×"], expl: "×—××¦×ª ×œ×§×˜×™×ª ×”×™× ×ª×•×¤×¢×” × ×“×™×¨×” ××š ×§×˜×œ× ×™×ª." },
        { q: "×ª×•×¤×¢×ª ×œ×•×•××™ ×§×•×¡××˜×™×ª ×©×œ Phenytoin?", a: "×©×™×¢×•×¨ ×™×ª×¨ ×•×¢×™×‘×•×™ ×—× ×™×›×™×™×", opts: ["×”×ª×§×¨×—×•×ª", "××§× ×”", "×¦×™×¤×•×¨× ×™×™× ×©×‘×™×¨×•×ª"], expl: "×”×™×¤×¨×¤×œ×–×™×” ×©×œ ×—× ×™×›×™×™× ×•×”×™×¨×¡×•×˜×™×–×." },
        { q: "×ª×¨×•×¤×” ×œ××¤×™×œ×¤×¡×™×” ×©××¡×•×¨×” ×‘×”×¨×™×•×Ÿ?", a: "Valproic Acid", opts: ["Insulin", "Paracetamol", "Penicillin"], expl: "×˜×¨×˜×•×’× ×™×ª ×××•×“, ×’×•×¨××ª ×œ××•××™× ×‘×¢×•×‘×¨." },
        { q: "×˜×™×¤×•×œ ×‘-Status Epilepticus?", a: "Diazepam (Valium) IV", opts: ["Phenytoin PO", "Carbamazepine", "Ethosuximide"], expl: "× ×“×¨×©×ª ×ª×¨×•×¤×” ××”×™×¨×” ×œ×•×•×¨×™×“ ×œ×¢×¦×™×¨×ª ×”×¤×¨×›×•×¡." },
        
        // General
        { q: "××”×• Antidote ×œ×”×¨×¢×œ×ª ××•×¤×™×•××™×“×™×?", a: "Naloxone", opts: ["Atropine", "Flumazenil", "Vitamin K"], expl: "×—×•×¡× ××ª ×”×¨×¦×¤×˜×•×¨ ×œ××•×¤×™×•×." },
        { q: "××”×• Antidote ×œ×§×•××“×™×Ÿ (Warfarin)?", a: "Vitamin K", opts: ["Protamine Sulfate", "Calcium", "Iron"], expl: "×§×•××“×™×Ÿ ××¢×›×‘ ×¤×§×˜×•×¨×™× ×ª×œ×•×™×™ ×•×™×˜××™×Ÿ K." },
        { q: "××”×• Antidote ×œ×”×¤×¨×™×Ÿ?", a: "Protamine Sulfate", opts: ["Vitamin K", "Aspirin", "Insulin"], expl: "× ×§×©×¨ ×œ×”×¤×¨×™×Ÿ ×•×× ×˜×¨×œ ××•×ª×•." },
        { q: "××“×•×¢ ××¡×•×¨ ×œ×”×¤×¡×™×§ ×¡×˜×¨×•××™×“×™× ×‘×‘×ª ××—×ª?", a: "×—×©×© ×œ××™ ×¡×¤×™×§×ª ××“×¨× ×œ (Addisonian Crisis)", opts: ["×”×›××‘ ×™×—×–×•×¨", "×”×©×× ×”", "×”×ª×™×™×‘×©×•×ª"], expl: "×”×’×•×£ ××¤×¡×™×§ ×œ×™×™×¦×¨ ×¡×˜×¨×•××™×“×™× ×œ×‘×“ ×‘×–××Ÿ ×”×˜×™×¤×•×œ." },
        { q: "×ª×¨×•×¤×” ×¢× ××™× ×“×§×¡ ×ª×¨×¤×•×™×˜×™ ×¦×¨ (Narrow Therapeutic Index)?", a: "×”×”×‘×“×œ ×‘×™×Ÿ ××™× ×•×Ÿ ×™×¢×™×œ ×œ×¨×¢×™×œ ×§×˜×Ÿ", opts: ["×¢×•×‘×“×ª ××”×¨", "×–×•×œ×”", "×‘×˜×•×—×” ×œ×©×™××•×©"], expl: "×“×•×¨×© × ×™×˜×•×¨ ×¨××•×ª ×‘×“× (×›××• ×“×™×’×•×§×¡×™×Ÿ)." },
        { q: "×˜×™×¤×•×œ ×‘×”×œ× ×× ×¤×™×œ×§×˜×™?", a: "Adrenaline (Epinephrine)", opts: ["Steroids", "Antihistamines", "Antibiotics"], expl: "××¦×™×œ ×—×™×™× ××™×™×“×™×ª." },
        { q: "××™×–×” ×¡×•×’ ××™× ×¡×•×œ×™×Ÿ ×”×•× '×‘×–××œ×™' (×œ×œ× ×¤×™×§)?", a: "Glargine (Lantus)", opts: ["Regular", "NPH", "Lispro"], expl: "×¤×•×¢×œ ×œ-24 ×©×¢×•×ª ×‘×¦×•×¨×” ×™×¦×™×‘×”." },
        { q: "××” ×¢×•×©×” Acarbose?", a: "××¢×›×‘×ª ×¤×™×¨×•×§ ×¤×—××™××•×ª ×‘××¢×™", opts: ["××’×‘×™×¨×” ××™× ×¡×•×œ×™×Ÿ", "××•×¦×™××” ×¡×•×›×¨ ×‘×©×ª×Ÿ", "×—×•×¡××ª ×ª×™××‘×•×Ÿ"], expl: "××•× ×¢×ª ×¡×¤×™×’×ª ×¡×•×›×¨ ××”××–×•×Ÿ." },
        { q: "×˜×™×¤×•×œ ×‘×¡×™×¡×™ ×œ×”×™×¤×•×’×œ×™×§××™×” ×‘×—×•×œ×” ×‘×”×›×¨×”?", a: "×¡×•×›×¨ ×–××™×Ÿ (××™×¥/×¡×•×›×¨×™×™×”) ×“×¨×š ×”×¤×”", opts: ["××™× ×¡×•×œ×™×Ÿ", "×’×œ×•×§×’×•×Ÿ ×‘×–×¨×™×§×”", "×”××ª× ×”"], expl: "×”×“×¨×š ×”××”×™×¨×” ×•×”×‘×˜×•×—×” ×‘×™×•×ª×¨." },
        { q: "×ª×¨×•×¤×” ×œ×¤×¨×›×•×¡×™ × ×™×ª×•×§ (Absence)?", a: "Ethosuximide", opts: ["Phenytoin", "Carbamazepine", "Phenobarbital"], expl: "×”×ª×•×•×™×” ×¡×¤×¦×™×¤×™×ª ×œ-Petit Mal." }
    ];

    /* --- VARIABLES --- */
    let practicePool = [];
    let currentPracIndex = 0;
    
    let examList = [];
    let examAnswers = [];
    let currentExamIndex = 0;
    let examTimerInt;
    let examSeconds = 0;

    /* --- UTILS --- */
    function shuffle(array) {
        return array.sort(() => 0.5 - Math.random());
    }

    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function goHome() {
        clearInterval(examTimerInt);
        switchScreen('screen-menu');
    }

    /* --- PRACTICE MODE LOGIC --- */
    function startPractice() {
        // Create a shuffled copy containing ALL questions
        practicePool = shuffle([...questionBank]);
        // Duplicate questions based on randomnessopts
        practicePool.forEach(q => {
            q.pracOpts = shuffle([q.a, ...q.opts]);
        });
        
        currentPracIndex = 0;
        switchScreen('screen-practice');
        loadPracticeQ();
    }

    function loadPracticeQ() {
        // Infinite Loop Logic: If we reached end, reshuffle and start over
        if (currentPracIndex >= practicePool.length) {
            practicePool = shuffle([...questionBank]);
            practicePool.forEach(q => q.pracOpts = shuffle([q.a, ...q.opts]));
            currentPracIndex = 0;
        }

        const q = practicePool[currentPracIndex];
        document.getElementById('prac-count').innerText = currentPracIndex + 1;
        
        const area = document.getElementById('prac-area');
        area.innerHTML = `
            <div class="q-card">
                <div class="q-text">${q.q}</div>
                <div class="options-grid">
                    ${q.pracOpts.map(opt => `<button class="opt-btn" onclick="checkPractice(this, '${opt}', '${q.a}')">${opt}</button>`).join('')}
                </div>
                <div class="practice-feedback" id="prac-fb">
                    <strong>${q.expl}</strong>
                </div>
            </div>
        `;

        document.getElementById('prac-next-btn').style.display = 'none';
    }

    function checkPractice(btn, selected, correct) {
        // Disable all buttons
        const parent = btn.parentElement;
        const allBtns = parent.querySelectorAll('.opt-btn');
        allBtns.forEach(b => b.disabled = true);

        const feedback = document.getElementById('prac-fb');
        feedback.style.display = 'block';

        if (selected === correct) {
            btn.classList.add('correct');
            feedback.style.borderRightColor = 'var(--success)';
            feedback.innerHTML = `<div style="color:var(--success); font-weight:bold; margin-bottom:5px;">âœ… ×ª×©×•×‘×” × ×›×•× ×”!</div>` + feedback.innerHTML;
        } else {
            btn.classList.add('wrong');
            feedback.style.borderRightColor = 'var(--error)';
            feedback.innerHTML = `<div style="color:var(--error); font-weight:bold; margin-bottom:5px;">âŒ ×˜×¢×•×ª. ×”×ª×©×•×‘×” ×”×™×: ${correct}</div>` + feedback.innerHTML;
            
            // Highlight correct answer
            allBtns.forEach(b => {
                if (b.innerText === correct) b.classList.add('correct');
            });
        }

        document.getElementById('prac-next-btn').style.display = 'block';
    }

    function nextPracticeQ() {
        currentPracIndex++;
        loadPracticeQ();
    }


    /* --- EXAM MODE LOGIC --- */
    function startExam() {
        // Pick 45 random questions (or less if bank is smaller, utilizing duplicates if needed to reach 45 not recommended, so we take max avail)
        // Since database is smaller in this code snippet, we'll take ALL or repeat. 
        // For the sake of the snippet, we'll use the full bank shuffled.
        
        let pool = shuffle([...questionBank]);
        // Note: Real PDF has hundreds, this snippet has ~30. We will loop to fill 45 for demo or just use pool length.
        // Let's create a 45 q exam by duplicating pool if needed for the simulation feel.
        while (pool.length < 45) {
            pool = pool.concat(shuffle([...questionBank]));
        }
        examList = pool.slice(0, 45);
        
        // Prepare options
        examList.forEach(q => {
            q.examOpts = shuffle([q.a, ...q.opts]);
        });

        examAnswers = new Array(examList.length).fill(null);
        currentExamIndex = 0;
        examSeconds = 0;

        // Timer
        clearInterval(examTimerInt);
        examTimerInt = setInterval(() => {
            examSeconds++;
            const m = Math.floor(examSeconds / 60).toString().padStart(2,'0');
            const s = (examSeconds % 60).toString().padStart(2,'0');
            document.getElementById('exam-timer').innerText = `${m}:${s}`;
        }, 1000);

        switchScreen('screen-exam');
        loadExamQ();
    }

    function loadExamQ() {
        const q = examList[currentExamIndex];
        document.getElementById('exam-q-num').innerText = currentExamIndex + 1;
        
        const area = document.getElementById('exam-area');
        const savedAns = examAnswers[currentExamIndex];

        area.innerHTML = `
            <div class="q-card">
                <div class="q-text">${q.q}</div>
                <div class="options-grid">
                    ${q.examOpts.map(opt => `
                        <button class="opt-btn ${savedAns === opt ? 'selected' : ''}" 
                                onclick="selectExamAns(this, '${opt}')">${opt}</button>
                    `).join('')}
                </div>
            </div>
        `;

        // Nav buttons
        document.getElementById('exam-prev').disabled = currentExamIndex === 0;
        
        if (currentExamIndex === examList.length - 1) {
            document.getElementById('exam-next').style.display = 'none';
            document.getElementById('exam-finish').style.display = 'block';
        } else {
            document.getElementById('exam-next').style.display = 'block';
            document.getElementById('exam-finish').style.display = 'none';
        }
    }

    function selectExamAns(btn, ans) {
        // UI update
        const parent = btn.parentElement;
        parent.querySelectorAll('.opt-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        
        // Save
        examAnswers[currentExamIndex] = ans;
    }

    function nextExamQ() {
        if (currentExamIndex < examList.length - 1) {
            currentExamIndex++;
            loadExamQ();
        }
    }

    function prevExamQ() {
        if (currentExamIndex > 0) {
            currentExamIndex--;
            loadExamQ();
        }
    }

    function finishExam() {
        clearInterval(examTimerInt);
        
        let correctCount = 0;
        let html = '';

        examList.forEach((q, i) => {
            const userAns = examAnswers[i];
            const isCorrect = userAns === q.a;
            if (isCorrect) correctCount++;

            html += `
                <div class="review-item ${isCorrect ? '' : 'bad'}">
                    <div style="font-weight:bold; color:${isCorrect ? 'var(--success)' : 'var(--error)'}">
                        ×©××œ×” ${i+1}: ${isCorrect ? '× ×›×•×Ÿ' : '×©×’×•×™'}
                    </div>
                    <div style="margin:5px 0;">${q.q}</div>
                    <div style="font-size:0.9rem">
                        ×ª×©×•×‘×ª×š: <b>${userAns || '---'}</b> <br>
                        <span style="color:var(--success)">×”×ª×©×•×‘×” ×”× ×›×•× ×”: <b>${q.a}</b></span>
                    </div>
                    <div style="margin-top:5px; background:#fff8e1; padding:5px; font-size:0.85rem;">
                        ğŸ’¡ ${q.expl}
                    </div>
                </div>
            `;
        });

        const score = Math.round((correctCount / examList.length) * 100);
        document.getElementById('final-score').innerText = score;
        
        let msg = "";
        if (score > 90) msg = "××œ×•×£! ××•×›×Ÿ ×œ××‘×—×Ÿ ×œ×’××¨×™ ğŸ†";
        else if (score > 70) msg = "×¢×‘×•×“×” ×˜×•×‘×”, ×¢×•×“ ×§×¦×ª ×œ×™×˜×•×© ğŸ‘Œ";
        else msg = "×›×“××™ ×œ×—×–×•×¨ ×¢×œ ×”×—×•××¨ ×©×•×‘ ğŸ“š";
        document.getElementById('score-msg').innerText = msg;

        document.getElementById('review-container').innerHTML = html;
        switchScreen('screen-results');
    }

</script>

</body>
</html>